var e=(e,t,a)=>new Promise(((l,n)=>{var u=e=>{try{r(a.next(e))}catch(t){n(t)}},i=e=>{try{r(a.throw(e))}catch(t){n(t)}},r=e=>e.done?l(e.value):Promise.resolve(e.value).then(u,i);r((a=a.apply(e,t)).next())}));import{u as t,B as a,a as l}from"./index2.js";import{b as n,r as u,e as i,o as r,i as o,j as s,k as c,l as d,s as f,v as p,x as v,u as y,f as h,F as m,a as _}from"./index.js";import{T as g}from"./index3.js";const b=["innerHTML"],k=n({__name:"PathSelectModal",emits:["select","register"],setup(l,{emit:n}){const h=g.DirectoryTree,m=n,{createPrompt:_}=y(),k=u(!0),x=u([]),R=u(""),S=u(),P=u(""),[j,{closeModal:w}]=t((t=>e(this,null,(function*(){P.value=t.title,0===x.value.length&&function(){e(this,null,(function*(){try{k.value=!0,x.value=yield v.get({url:"/sys/fs/tree/root"})}finally{k.value=!1}}))}()}))));function C(){S.value&&m("select",S.value.dataRef.path),w()}function D(){w()}function M(t){return e(this,null,(function*(){t.dataRef.children||B(t.dataRef.path,t)}))}function T(e,{node:t}){R.value=e[0],S.value=t}function A(){if(S.value){let t=S.value.dataRef.path;_({title:"请输入新目录名称",required:!0,onOk(a){return e(this,null,(function*(){k.value=!0;try{yield v.put({url:"/sys/fs/create-dir",params:{path:t,name:a}}),yield B(t,S.value)}finally{k.value=!1}}))}})}}function B(t,a){return e(this,null,(function*(){let e={path:t};a.dataRef.children=yield v.get({url:"/sys/fs/tree/children",params:e}),x.value=[...x.value]}))}return(e,t)=>{const l=i("a-spin"),n=i("a-button"),u=i("a-col"),v=i("a-row");return r(),o(f(a),{onRegister:f(j),title:P.value,width:500,onOk:C,onCancel:D},{footer:s((()=>[c(v,{type:"flex",justify:"space-between"},{default:s((()=>[c(u,null,{default:s((()=>[c(n,{type:"primary",disabled:!S.value,onClick:A},{default:s((()=>[d("创建新目录")])),_:1},8,["disabled"])])),_:1}),c(u,null,{default:s((()=>[c(n,{onClick:D},{default:s((()=>[d("取消")])),_:1}),c(n,{type:"primary",onClick:C},{default:s((()=>[d("确定")])),_:1})])),_:1})])),_:1})])),default:s((()=>[c(l,{spinning:k.value},{default:s((()=>[c(f(h),{treeData:x.value,loadData:M,expandAction:"dblclick",onSelect:T},{title:s((({title:e,key:t})=>[p("span",{innerHTML:e},null,8,b)])),_:1},8,["treeData"])])),_:1},8,["spinning"])])),_:1},8,["onRegister","title"])}}});var x=_(n({__name:"PathSelect",props:{value:String,title:{type:String,default:"选择目录"},onlyDir:{type:Boolean,default:!0},beforeSelect:Function},emits:["update:value"],setup(e,{emit:t}){const a=e,n=t,[u,{openModal:o}]=l();function d(){o(!0,a)}function v(e){"function"==typeof a.beforeSelect&&(e=a.beforeSelect(e)),y(e)}function y(e){n("update:value",e)}return(t,a)=>{const l=i("a-input");return r(),h(m,null,[c(l,{class:"file-select-input",value:e.value,placeholder:e.title,"onUpdate:value":y},{addonAfter:s((()=>[p("span",{onClick:d,style:{cursor:"pointer"}},"选择")])),_:1},8,["value","placeholder"]),c(k,{onRegister:f(u),onSelect:v},null,8,["onRegister"])],64)}}}),[["__scopeId","data-v-4e8e1dc4"]]);export{x as P};
