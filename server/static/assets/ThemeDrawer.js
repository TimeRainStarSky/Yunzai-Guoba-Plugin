var e=Object.defineProperty,t=Object.defineProperties,n=Object.getOwnPropertyDescriptors,i=Object.getOwnPropertySymbols,r=Object.prototype.hasOwnProperty,a=Object.prototype.propertyIsEnumerable,o=(t,n,i)=>n in t?e(t,n,{enumerable:!0,configurable:!0,writable:!0,value:i}):t[n]=i,l=(e,t)=>{for(var n in t||(t={}))r.call(t,n)&&o(e,n,t[n]);if(i)for(var n of i(t))a.call(t,n)&&o(e,n,t[n]);return e},s=(e,t,n)=>new Promise(((i,r)=>{var a=e=>{try{l(n.next(e))}catch(t){r(t)}},o=e=>{try{l(n.throw(e))}catch(t){r(t)}},l=e=>e.done?i(e.value):Promise.resolve(e.value).then(a,o);l((n=n.apply(e,t)).next())}));import{a as u,B as m}from"./index32.js";import{b as p,B as c,U as d,eQ as f,r as y,I as g,s as j,e as v,o as h,i as w,j as x,k as b,v as k,l as O,c8 as _,V as P,m as C,a4 as L,a5 as I,aL as N,u as S}from"./index.js";import"./PathSelect.js";import{c as $,d as B,p as T,e as F}from"./miao.api.js";import M from"./ThemeConfigModal.js";import{a as D}from"./index2.js";import"./index11.js";import"./ArrowLeftOutlined.js";import"./index3.js";import"./base64Conver.js";import"./BasicForm.js";import"./index4.js";import"./find.js";import"./_baseIteratee.js";import"./get.js";import"./index5.js";import"./index6.js";import"./useFormItem.js";import"./transButton.js";import"./upperFirst.js";import"./download.js";import"./index7.js";import"./index8.js";import"./uniqBy.js";import"./miao.data.js";import"./lodash.default.js";import"./throttle.js";import"./merge.js";import"./useWindowSizeFn.js";import"./FullscreenOutlined.js";const R={style:{"margin-bottom":"8px"}},E={class:"theme-desc"},q=["src"],z=p({__name:"ThemeDrawer",props:{themeNames:Array},emits:["register","reload","update:themeNames"],setup(e,{emit:i}){const r=e,a=i,o=c(),{prefixCls:p}=d("miao-plugin-theme-drawer"),{createMessage:z,createConfirm:A}=N(),{createPrompt:W}=S(),J=f(),Q=y(),U=y(!1),V=y([]),[G,{closeDrawer:H,setDrawerProps:K}]=u((function(){ne()})),[X,Y]=D(),Z=g((()=>{let e={width:document.body.clientWidth>=768?700:"100%",title:"喵喵帮助皮肤",confirmLoading:j(U)};var i;return i=l(l(l({},j(o)),e),r),t(i,n({onOk:ie,onCancel:ie,onRegister:G}))}));let ee={};function te(e,t="main"){let n=ee[e]||1;return`/api/plugin/miao/help/theme/$s?token=${J.liteToken}&themeName=${e}&_v=${n}`.replace("$s",t)}function ne(){return s(this,null,(function*(){try{le(!0),V.value=yield $();let e=V.value.map((e=>e.name));a("update:themeNames",e)}finally{le(!1)}}))}function ie(){H()}let re=null;function ae(){return Q.value.value="",Q.value.click(),new Promise((e=>{let t=!1,n=()=>{setTimeout((()=>{t||e(null)}),500)},i=i=>{t||(t=!0,window.removeEventListener("focus",n),e(i))};window.addEventListener("focus",n),re=function(e){return s(this,null,(function*(){var t;let n=null==(t=null==e?void 0:e.target)?void 0:t.files;n&&n.length<=0?i(null):i(n[0])}))}}))}function oe(){W({title:"新增皮肤",required:!0,placeholder:"请输入皮肤名称",okText:"确定并选择底图",onOk(e){return s(this,null,(function*(){let t=yield ae();if(!t)return Promise.reject("未选择底图");yield B(e,t),yield ne()}))}})}function le(e){U.value=e,K({confirmLoading:e})}function se(e){"function"==typeof re&&(re(e),re=null)}function ue(e){return[{event:"change",text:"修改配置",icon:"ant-design:edit",onClick(){Y.openModal(!0,e)}},{event:"changePic",text:"更改底图",icon:"akar-icons:image",onClick(){return s(this,null,(function*(){try{le(!0);let t=yield ae();if(t){yield T(e.name,t);let n=ee[e.name]||1;ee[e.name]=++n}}finally{le(!1)}}))}},{event:"delete",text:"删除皮肤",icon:"ant-design:delete",onClick(){A({title:"删除",iconType:"warning",content:`确定要删除“${e.name}”吗？删除后不可恢复！`,onOk:()=>function(e){return s(this,null,(function*(){try{if("default"===e.name)return void z.warn("默认皮肤不可删除");le(!0),yield F(e.name),yield ne()}finally{le(!1)}}))}(e)})}}]}return(e,t)=>{const n=v("a-button"),i=v("a-col"),r=v("a-row"),a=v("a-list-item-meta"),o=v("a-list-item"),l=v("a-list"),s=v("a-spin");return h(),w(j(m),L(I(Z.value)),{default:x((()=>[b(s,{wrapperClassName:`${j(p)} p-2`,spinning:U.value},{default:x((()=>[k("div",R,[b(n,{type:"primary",preIcon:"ant-design:plus",onClick:oe},{default:x((()=>[O("新增皮肤")])),_:1})]),b(l,{size:"large",bordered:"",dataSource:V.value},{renderItem:x((({item:e})=>[b(o,null,{actions:x((()=>["default"!==e.name?(h(),w(j(_),{key:0,trigger:["click"],dropMenuList:ue(e)},{default:x((()=>[b(n,{type:"primary",shape:"circle",preIcon:"ant-design:setting"})])),_:2},1032,["dropMenuList"])):P("",!0)])),default:x((()=>[b(a,{title:e.name},{description:x((()=>[k("div",E,[b(r,{type:"flex",gutter:8},{default:x((()=>[b(i,{style:{width:"150px"}},{default:x((()=>[k("img",{src:te(e.name),alt:"皮肤底图"},null,8,q)])),_:2},1024),b(i,{style:{flex:"1"}},{default:x((()=>[k("pre",null,C(JSON.stringify(e.style,null,2)),1)])),_:2},1024)])),_:2},1024)])])),_:2},1032,["title"])])),_:2},1024)])),_:1},8,["dataSource"])])),_:1},8,["wrapperClassName","spinning"]),b(M,{onRegister:j(X),onSuccess:ne},null,8,["onRegister"]),k("input",{ref_key:"uploadBgRef",ref:Q,type:"file",name:"upload-bg",accept:"image/bmp,image/jpeg,image/png",onChange:se,style:{display:"none"}},null,544)])),_:1},16)}}});export{z as default};
