var e=Object.defineProperty,t=Object.defineProperties,o=Object.getOwnPropertyDescriptors,l=Object.getOwnPropertySymbols,a=Object.prototype.hasOwnProperty,n=Object.prototype.propertyIsEnumerable,i=(t,o,l)=>o in t?e(t,o,{enumerable:!0,configurable:!0,writable:!0,value:l}):t[o]=l,s=(e,t,o)=>new Promise(((l,a)=>{var n=e=>{try{s(o.next(e))}catch(t){a(t)}},i=e=>{try{s(o.throw(e))}catch(t){a(t)}},s=e=>e.done?l(e.value):Promise.resolve(e.value).then(n,i);s((o=o.apply(e,t)).next())}));import r from"./EditBodyModal.js";import{b as p,fY as c,eQ as d,U as m,r as u,w as h,e as g,o as b,f,v,k as y,j,O as B,m as C,F as x,h as $,i as w,s as k,V as O,l as D,W as L,aK as I,aL as M}from"./index.js";import{a as S}from"./index2.js";import{c as P}from"./common.js";import{HelpTable as F}from"./HelpComps.js";import N from"./UploadIconHelpModal.js";import{b as U,a as W}from"./miao.api.js";import{l as _}from"./lodash.default.js";import"./index6.js";import"./SelectIconModal.js";import"./IconUploader.js";import"./esm.js";import"./useWindowSizeFn.js";import"./FullscreenOutlined.js";import"./21ae6624.js";import"./base64Conver.js";import"./upperFirst.js";import"./_baseIteratee.js";import"./get.js";import"./find.js";import"./throttle.js";import"./merge.js";import"./uniqBy.js";const z={class:"container"},E={class:"setting-box"},R=v("input",{type:"file",id:"upload-bg",style:{display:"none"},name:"icon",accept:"image/bmp,image/jpeg,image/png"},null,-1),A=v("input",{type:"file",id:"upload-icon",style:{display:"none"},name:"icon",accept:"image/png"},null,-1),H={class:"info-box"},V={class:"head-box type"},T={class:"title"},Y={class:"label"},q=["onClick"],K={class:"copyright"},Q={class:"version"},G={class:"version"},J=p({__name:"HelpPanel",props:{helpCfg:Object,helpList:Object,bgB64:String,mainB64:String,cacheVer:Number,themeName:String,themeNames:Array,iconB64List:Array,modelData:Object,themeStyle:Object,versions:Object},emits:["update:themeStyle","update:modelData","update:mainB64","update:iconB64List","open-setting"],setup(e,{emit:p}){const J=e,X=p,Z=c(),ee=d(),{prefixCls:te}=m("miao-plugin-help-panel"),{createMessage:oe}=M(),[le,ae]=S(),ne=u(1),ie=u(3),se=u(850),re=()=>{let e=function(){let{helpCfg:e}=J;if(!e)return{style:"",colCount:3};let t=Math.min(5,Math.max(parseInt(null==e?void 0:e.colCount)||3,2)),o=Math.min(500,Math.max(100,parseInt(null==e?void 0:e.colWidth)||265)),l=Math.min(2500,Math.max(800,t*o+30)),a=[];a.push(`.${te} { width:${l}px; }`),a.push(`.${te} .help-table .td,.help-table .th{width:${100/t}%}`);let n=`/api/plugin/miao/help/theme/$s?token=${ee.liteToken}&themeName=${J.themeName}&_v=${J.cacheVer}`,i=n.replace("$s","bg"),s=n.replace("$s","main");J.mainB64&&(s=J.mainB64);let r=`background: url(${s}) top left/100% auto no-repeat,url(${i})`;a.push(`.${te} .container { width:${l}px; ${r}; }`);let p=function(e,t,o,l,n){let i=function(...e){for(let t of e)if(!_.isUndefined(t))return t}(J.themeStyle[o],l);n&&(i=n(i)),a.push(`.${te} ${e}{${t}:${i}}`)};return p(".help-title,.help-group","color","fontColor","#ceb78b"),p(".help-title,.help-group","text-shadow","fontShadow","none"),p(".help-desc","color","descColor","#eee"),p(".cont-box","background","contBgColor","rgba(43, 52, 61, 0.8)"),p(".cont-box","backdrop-filter","contBgBlur",3,(t=>!1===(null==e?void 0:e.bgBlur)?"none":`blur(${t}px)`)),p(".help-group","background","headerBgColor","rgba(34, 41, 51, .4)"),p(".help-table .tr:nth-child(odd)","background","rowBgColor1","rgba(34, 41, 51, .2)"),p(".help-table .tr:nth-child(even)","background","rowBgColor2","rgba(34, 41, 51, .4)"),{style:`${a.join("\n")}`,width:l,colCount:t}}();e.style&&P(e.style,te),se.value=e.width||850,ie.value=e.colCount},pe=I(re,300);h([()=>J.helpCfg,()=>J.themeName],pe,{immediate:!0,deep:!0}),h((()=>J.themeStyle),re,{immediate:!0,deep:!0}),h(se,(e=>{document.body.clientWidth>=e?ne.value=1:ne.value=parseFloat((document.body.clientWidth/e).toFixed(4))}),{immediate:!0}),u([{event:"changeBackground",text:"更换背景",icon:"akar-icons:image",onClick(){de("upload-bg",(e=>{X("update:mainB64",e)}))}},{event:"uploadIcon",text:"上传图标",icon:"fontisto:nav-icon-grid",onClick(){let e=()=>{de("upload-icon",(e=>s(this,null,(function*(){let t=yield W(e);X("update:iconB64List",t),oe.success("上传成功")}))))};!0===Z.get("hide-upload-icon-help-modal",!1)?e():ae.openModal(!0,e)}}]),h((()=>J.themeName),(e=>s(this,null,(function*(){X("update:themeStyle",yield U(e))}))),{immediate:!0});const ce={};function de(e,t){let o=document.getElementById(e);ce[e]||(ce[e]=!0,o.addEventListener("change",(e=>{let l=e.target.files;if(0!==l.length){let e=l[0],a=new FileReader;a.readAsDataURL(e),a.onload=()=>{t(a.result),o.value=null}}}))),o.click()}const me=(e,t,o,l)=>{var a,n;let i=!0;(null==(a=J.modelData)?void 0:a.show)&&e&&e===(null==(n=J.modelData)?void 0:n.cell)&&(i=!1),X("update:modelData",{show:i,cell:e,cellIndex:t,group:o,groupIndex:l})};function ue(){var e;X("open-setting"),X("update:modelData",(e=((e,t)=>{for(var o in t||(t={}))a.call(t,o)&&i(e,o,t[o]);if(l)for(var o of l(t))n.call(t,o)&&i(e,o,t[o]);return e})({},J.modelData),t(e,o({show:!1}))))}return(t,o)=>{const l=g("Icon"),a=g("a-button");return b(),f("div",{class:L([k(te)]),style:B(`transform: scale(${ne.value});transform-origin: center top;`)},[v("div",z,[v("div",E,[R,A,y(a,{style:B(`transform: scale(${1/ne.value});transform-origin: right top;`),type:"primary",shape:"circle",size:"large",onClick:ue},{default:j((()=>[y(l,{icon:"ion:settings-outline"})])),_:1},8,["style"])]),v("div",H,[v("div",V,[v("div",T,C(e.helpCfg.title),1),v("div",Y,C(e.helpCfg.subTitle),1)])]),(b(!0),f(x,null,$(e.helpList,((t,o)=>{var l;return b(),f("div",{class:"cont-box",key:o},[v("div",{class:"help-group",onClick:e=>me(null,null,t,o)},[v("span",null,C(t.group),1)],8,q),(null==(l=t.list)?void 0:l.length)?(b(),w(k(F),{key:0,list:t.list,colCount:ie.value,iconB64List:e.iconB64List,modelData:e.modelData,onOpen:(e,l)=>me(e,l,t,o)},null,8,["list","colCount","iconB64List","modelData","onOpen"])):O("",!0)])})),128)),v("div",K,[D(" Created By Yunzai-Bot "),v("span",Q,C(e.versions.yunzai),1),D(" & Miao-Plugin "),v("span",G,C(e.versions.miao),1)])]),y(r,{panelCls:k(te),helpList:e.helpList,modelData:e.modelData,iconB64List:e.iconB64List,"onUpdate:modelData":o[0]||(o[0]=e=>X("update:modelData",e))},null,8,["panelCls","helpList","modelData","iconB64List"]),y(N,{onRegister:k(le)},null,8,["onRegister"])],6)}}});export{J as default};
